/**
 * Object Pool.
 * Website => https://www.fal-works.com/
 * Including module: p5ex (Copyright 2018 FAL, licensed under MIT).
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.1
 * @license CC-BY-SA-3.0
 */
!function(){"use strict";function t(t,e,i,s){return t&&void 0!==e?null===e?new l(t):i?new d(t,e,s):new h(t,e):new c}function e(t){return t}function i(t){return 1-Math.pow(t-1,4)}function s(t,e,i,s){return t[0]=e,t[1]=i,t[2]=s,t}function n(t){return 255*function(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}(Math.min(Math.max(t,0),1))}function o(t,e,i,o){const r=function(t,e,i){const s=(t[0]+16)/116,n=s+t[1]/500,o=s-t[2]/200;return i?(i[0]=e.tristimulusValues[0]*w(n),i[1]=e.tristimulusValues[1]*w(s),i[2]=e.tristimulusValues[2]*w(o),i):[e.tristimulusValues[0]*w(n),e.tristimulusValues[1]*w(s),e.tristimulusValues[2]*w(o)]}(s(R,t,e,i),v,y),a=function(t,e,i){const s=t.length,n=t[0].length,o=i||new Array(s);for(let r=0;r<s;r+=1){o[r]=0;for(let i=0;i<n;i+=1)o[r]+=t[r][i]*e[i]}return o}(S,r,P),h=s(b,n(a[0]),n(a[1]),n(a[2]));return o?[h[0],h[1],h[2],o]:[h[0],h[1],h[2]]}class r{constructor(t,e,i,s){this.p=t,this.canvasElement=t.createCanvas(e.scaledWidth,e.scaledHeight,s),this.canvasElement&&"parent"in this.canvasElement&&this.canvasElement.parent(i),this.nonScaledShortSideLength=e.nonScaledShortSideLength,this.updateSize()}get scaleFactor(){return this._scaleFactor}get nonScaledWidth(){return this._nonScaledWidth}get nonScaledHeight(){return this._nonScaledHeight}get aspectRatio(){return this._aspectRatio}resize(t){this.p.resizeCanvas(t.scaledWidth,t.scaledHeight),this.nonScaledShortSideLength=t.nonScaledShortSideLength,this.updateSize()}updateSize(){const t=this.p;this._scaleFactor=Math.min(t.width,t.height)/this.nonScaledShortSideLength,this._inversedScaleFactor=1/this._scaleFactor,this._nonScaledWidth=t.width/this._scaleFactor,this._nonScaledHeight=t.height/this._scaleFactor,this._aspectRatio=t.width/t.height}scale(){this.p.scale(this._scaleFactor)}cancelScale(){this.p.scale(this._inversedScaleFactor)}getNonScaledValueOf(t){return t/this._scaleFactor}}r.DUMMY_PARAMETERS={scaledWidth:100,scaledHeight:100,nonScaledShortSideLength:100};const a={SQUARE640x640:"SQUARE640x640",RECT640x480:"RECT640x480",FULL:"FULL",CUSTOM:"CUSTOM"};class h{constructor(t,e){this.p=t,this.p5Color=e}stroke(){this.p.currentRenderer.stroke(this.p5Color)}fill(){this.p.currentRenderer.fill(this.p5Color)}}class l{constructor(t){this.p=t}stroke(){this.p.currentRenderer.noStroke()}fill(){this.p.currentRenderer.noFill()}}class c{stroke(){}fill(){}}class d{constructor(t,e,i=256){this.p=t;const s=[];for(let n=0;n<i;n+=1)s.push(t.color(t.red(e),t.green(e),t.blue(e),t.alpha(e)*n/(i-1)));this.colorArray=s,this.maxIndex=i-1}stroke(t){this.p.currentRenderer.stroke(this.getColor(t))}fill(t){this.p.currentRenderer.fill(this.getColor(t))}getColor(t){return this.colorArray[t?Math.floor(this.p.map(t,0,255,0,this.maxIndex)):this.maxIndex]}}class u{constructor(e,i,s,n,o){this.strokeColor=t(e,i,n,o),this.fillColor=t(e,s,n,o)}applyColor(t){this.strokeColor.stroke(t),this.fillColor.fill(t)}}u.UNDEFINED=new u(void 0,void 0,void 0);const p=()=>{},g=(Math.PI,new p5(t=>{t.setup=(()=>{t.noCanvas()})}));Math.PI,g.createVector(),g.createVector();class m{}class C extends m{get width(){return this.rightPositionX-this.leftPositionX}get height(){return this.bottomPositionY-this.topPositionY}get area(){return this.width*this.height}constructor(t,e,i,s,n=0){super(),this.leftPositionX=t-n,this.topPositionY=e-n,this.rightPositionX=i+n,this.bottomPositionY=s+n}contains(t){return t.x>=this.leftPositionX&&t.x<=this.rightPositionX&&t.y>=this.topPositionY&&t.y<=this.bottomPositionY}}const w=t=>t>6/29?t*t*t:6/29*3*(6/29)*(t-16/116),S=[[3.2406255,-1.537208,-.4986286],[-.9689307,1.8757561,.0415175],[.0557101,-.2040211,1.0569959]];class f{constructor(t,e){this.name=t,this.tristimulusValues=e}}let v={D50:new f("D50",[.9642,1,.8251]),D55:new f("D55",[.9568,1,.9214]),D65:new f("D65",[.95047,1,1.08883]),E:new f("E",[1,1,1])}.D50;const R=[0,0,0],y=[0,0,0],P=[0,0,0],b=[0,0,0];class x{constructor(t=256){this.array=new Array(t),this.length=0}get(t){return this.array[t]}getLast(){return this.array[this.length-1]}push(t){return this.array[this.length]=t,this.length+=1,this.length}pushRawArray(t,e=t.length){for(let i=0;i<e;i+=1)this.array[this.length+i]=t[i];return this.length+=e,this.length}pushAll(t){return this.pushRawArray(t.array,t.length)}pop(){return this.length-=1,this.array[this.length]}clear(){this.length=0}loop(t){!function(t,e,i){let s=0;for(;s<i;)e(t[s],s,t),s+=1}(this.array,t,this.length)}loopBackwards(t){!function(t,e,i){for(;i--;)e(t[i],i,t)}(this.array,t,this.length)}roundRobin(t){!function(t,e,i){for(let s=0,n=i-1;s<n;s+=1)for(let o=s+1;o<i;o+=1)e(t[s],t[o])}(this.array,t,this.length)}nestedLoopJoin(t,e){!function(t,e,i,s,n){for(let o=0;o<s;o+=1)for(let s=0;s<n;s+=1)i(t[o],e[s])}(this.array,t.array,e,this.length,t.length)}}class _ extends x{static drawFunction(t){t.draw()}draw(){this.loop(_.drawFunction)}}class M extends x{static stepFunction(t){t.step()}step(){this.loop(M.stepFunction)}}class E extends x{}E.prototype.step=M.prototype.step,E.prototype.draw=_.prototype.draw;class F extends x{constructor(t){super(t),this.recentRemovedElements=new x(t)}clean(){this.recentRemovedElements.clear();let t=0;for(let e=0;e<this.length;e+=1)this.array[e].clean(),this.array[e].isToBeRemoved?this.recentRemovedElements.push(this.array[e]):(this.array[t]=this.array[e],t+=1);this.length=t}}class L extends F{}L.prototype.draw=E.prototype.draw,L.prototype.step=E.prototype.step;g.createVector(),g.createVector(),g.createVector();class T{constructor(){this.count=0}resetCount(t=0){return this.count=t,this}step(){this.count+=1}mod(t){return this.count%t}}class A extends T{get isOn(){return this._isOn}constructor(t,e=p){super(),this._isOn=!0,this.completeBehavior=e,this.durationFrameCount=t}on(t){return this._isOn=!0,t&&(this.durationFrameCount=t),this}off(){return this._isOn=!1,this}step(){this._isOn&&(this.count+=1,this.count>this.durationFrameCount&&this.completeCycle())}}class V extends A{get isCompleted(){return this._isCompleted}constructor(t,e){super(t,e),this._isCompleted=!1}on(t){return super.on(t),this}off(){return super.off(),this}resetCount(){return super.resetCount(),this._isCompleted=!1,this}getProgressRatio(){return this._isCompleted?1:this.count/this.durationFrameCount}completeCycle(){this._isCompleted=!0,this._isOn=!1,this.completeBehavior()}}p5.disableFriendlyErrors=!0;new p5;new class extends p5{setCurrentRenderer(t){this.currentRenderer=t}get nonScaledWidth(){return this.scalableCanvas.nonScaledWidth}get nonScaledHeight(){return this.scalableCanvas.nonScaledHeight}get idealFrameRate(){return this._idealFrameRate}get unitAngleSpeed(){return this._unitAngleSpeed}get unitSpeed(){return this._unitSpeed}get unitAccelerationMagnitude(){return this._unitAccelerationMagnitude}constructor(t,e,i){super(t,"string"==typeof e?document.getElementById(e)||void 0:e,i),this.node=e&&"boolean"!=typeof e?"string"==typeof e?document.getElementById(e)||document.body:e:document.body,this.currentRenderer=this,this.maxCanvasRegion={width:0,height:0,getShortSideLength(){return Math.min(this.width,this.height)}},this.updateMaxCanvasRegion(),this.setFrameRate()}setFrameRate(t=60){return this.frameRate(t),t&&(this._idealFrameRate=t,this._unitAngleSpeed=2*Math.PI/this._idealFrameRate,this._unitSpeed=1/this._idealFrameRate,this._unitAccelerationMagnitude=this._unitSpeed/this._idealFrameRate),this}updateMaxCanvasRegion(){if(this.maxCanvasRegion.width=this.windowWidth,this.maxCanvasRegion.height=this.windowHeight,this.node===document.body)return;const t=this.node.getBoundingClientRect();this.maxCanvasRegion.width=t.width,this.maxCanvasRegion.height=t.height}createScalableCanvas(t,e,i){this.scalableCanvasType=t,this.scalableCanvas=new r(this,this.createScalableCanvasParameter(t,e),this.node,i)}resizeScalableCanvas(t,e){this.scalableCanvas.resize(this.createScalableCanvasParameter(t||this.scalableCanvasType,e))}createScalableCanvasParameter(t,e){this.updateMaxCanvasRegion();const i=this.maxCanvasRegion.getShortSideLength();switch(t){case a.SQUARE640x640:return{scaledWidth:i,scaledHeight:i,nonScaledShortSideLength:640};case a.RECT640x480:return{scaledWidth:i,scaledHeight:.75*i,nonScaledShortSideLength:480};case a.FULL:return{scaledWidth:this.maxCanvasRegion.width,scaledHeight:this.maxCanvasRegion.height,nonScaledShortSideLength:640};default:return e||r.DUMMY_PARAMETERS}}}(t=>{const e=t.color(248),i=new C(0,0,640,640),s=new C(40,120,600,600),n=new u(t,t.color(0,24),t.color(252)),o=new u(t,null,t.color(0,64)),r=24,h=.3,l=new E(256),c=new L(256),d=t.createVector(),p=new class extends A{constructor(t,e){super(t,e)}on(t){return super.on(t),this}off(){return super.off(),this}getProgressRatio(){return this.count/this.durationFrameCount}completeCycle(){this.completeBehavior(),this.count=0}}(60);t.preload=(()=>{}),t.setup=(()=>{window.noCanvas(),t.createScalableCanvas(a.SQUARE640x640),W.initialize(l,s,new u(t,null,t.color(64),!0),new u(t,t.color(128),null,!0));for(let e=0;e<128;e+=1)l.push(new W(t));t.rectMode(t.CORNERS),t.ellipseMode(t.CENTER),t.strokeWeight(1.5),t.background(255)}),t.draw=(()=>{t.blendMode(t.BLEND),t.background(e),t.scalableCanvas.scale(),p.step(),d.set(t.scalableCanvas.getNonScaledValueOf(t.mouseX),t.scalableCanvas.getNonScaledValueOf(t.mouseY)),t.mouseIsPressed&&function(t){if(!s.contains(t))return;if(0===l.length)return;const e=l.pop();e.revive(t),c.push(e)}(d),function(t){n.applyColor(),t.rect(s.leftPositionX,s.topPositionY,s.rightPositionX,s.bottomPositionY)}(t),function(t){const e=t.mouseIsPressed?.5:1,i=p.getProgressRatio()*t.TWO_PI;t.blendMode(t.BLEND),o.applyColor(),t.ellipse(d.x,d.y,e*r*(1+h*Math.cos(i)),e*r*(1+h*Math.sin(i)))}(t),l.step(),l.draw(),c.step(),c.clean(),c.draw()}),t.windowResized=(()=>{t.resizeScalableCanvas(),t.background(255)}),t.mousePressed=(()=>{}),t.touchMoved=(()=>{if(i.contains(d))return!1})},"ObjectPool");class W{constructor(t){this.p=t,this.isToBeRemoved=!1,this.isAlive=!1,this.birthTimer=new V(15).off(),this.deathTimer=new V(15).off(),this.coolingTimer=new V(60).off(),this.timers=new M(3),this.waitingPosition=t.createVector(),this.resetWaitingPosition(),this.position=t.createVector(),this.position.set(this.waitingPosition),this.velocity=t.createVector(),this.deathPosition=t.createVector();const e=function(t,e,i){return g.color(g.red(t)-g.red(e),g.green(t)-g.green(e),g.blue(t)-g.blue(e),i)}(t.color(255),t.color(function(t,e,i,s){return o(t,e*Math.cos(i),e*Math.sin(i),s)}(80,100,t.random(0,t.TWO_PI))));this.properShapeColor=new u(t,null,e),this.properLineColor=new u(t,e,void 0,!0),this.timers.pushRawArray([this.birthTimer,this.deathTimer,this.coolingTimer])}static initialize(t,e,i,s){this.pool=t,this.region=e,this.deadShapeColor=i,this.deadLineColor=s}step(){this.timers.step(),this.isAlive&&this.position.add(this.velocity)}clean(){this.isAlive&&!W.region.contains(this.position)&&this.kill()}draw(){this.birthTimer.isOn?this.drawBirthLine():this.deathTimer.isOn&&this.drawDeathLine(),this.p.blendMode(this.p.DIFFERENCE),this.properShapeColor.applyColor(),this.drawShape(),this.isAlive||(this.p.blendMode(this.p.BLEND),W.deadShapeColor.applyColor(255*this.coolingTimer.getProgressRatio()),this.drawShape())}revive(t){this.isToBeRemoved=!1,this.position.set(t);const e=this.p.random(this.p.TWO_PI);this.velocity.set(Math.cos(e),Math.sin(e)),this.isAlive=!0,this.birthTimer.resetCount().on()}kill(){this.isToBeRemoved=!0,this.isAlive=!1,this.deathPosition.set(this.position),this.resetWaitingPosition(),this.position.set(this.waitingPosition),this.deathTimer.resetCount().on(),this.coolingTimer.resetCount().on(),W.pool.push(this)}resetWaitingPosition(){const t=W.pool.length,e=W.waitingColumnCount,i=this.p.nonScaledWidth/(e+1);this.waitingPosition.set((1+t%e)*i,(1+Math.floor(t/e))*i)}drawShape(){this.p.ellipse(this.position.x,this.position.y,W.size,W.size)}drawTrimmedLine(t,e,i,s){const n=e.x-t.x,o=e.y-t.y,r=t.x+i*n,a=t.y+i*o,h=t.x+s*n,l=t.y+s*o;this.p.line(r,a,h,l)}drawBirthLine(){const t=this.birthTimer.getProgressRatio();this.p.blendMode(this.p.DIFFERENCE),this.properLineColor.applyColor(64+191*t),this.drawTrimmedLine(this.waitingPosition,this.position,e(t),i(t))}drawDeathLine(){const t=this.deathTimer.getProgressRatio();this.p.blendMode(this.p.BLEND),W.deadLineColor.applyColor(64+191*t),this.drawTrimmedLine(this.deathPosition,this.waitingPosition,e(t),i(t))}}W.waitingColumnCount=32,W.size=12}();