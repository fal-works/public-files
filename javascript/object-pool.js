/**
 * Object Pool.
 * Website => https://www.fal-works.com/
 * @copyright 2018 FAL
 * @author FAL <falworks.contact@gmail.com>
 * @version 0.1.1
 * @license CC-BY-SA-3.0
 */
!function(i){"use strict";p5.disableFriendlyErrors=!0;new p5;new i.p5exClass(t=>{const o=t.color(248),s=new i.RectangleRegion(0,0,640,640),n=new i.RectangleRegion(40,120,600,600),r=new i.ShapeColor(t,t.color(0,24),t.color(252)),a=new i.ShapeColor(t,null,t.color(0,64)),h=24,l=.3,p=new i.SpriteArray(256),d=new i.CleanableSpriteArray(256),c=t.createVector(),C=new i.LoopedFrameCounter(60);t.preload=(()=>{}),t.setup=(()=>{window.noCanvas(),t.createScalableCanvas(i.ScalableCanvasTypes.SQUARE640x640),e.initialize(p,n,new i.ShapeColor(t,null,t.color(64),!0),new i.ShapeColor(t,t.color(128),null,!0));for(let i=0;i<128;i+=1)p.push(new e(t));t.rectMode(t.CORNERS),t.ellipseMode(t.CENTER),t.strokeWeight(1.5),t.background(255)}),t.draw=(()=>{t.blendMode(t.BLEND),t.background(o),t.scalableCanvas.scale(),C.step(),c.set(t.scalableCanvas.getNonScaledValueOf(t.mouseX),t.scalableCanvas.getNonScaledValueOf(t.mouseY)),t.mouseIsPressed&&function(i){if(!n.contains(i))return;if(0===p.length)return;const e=p.pop();e.revive(i),d.push(e)}(c),function(i){r.applyColor(),i.rect(n.leftPositionX,n.topPositionY,n.rightPositionX,n.bottomPositionY)}(t),function(i){const e=i.mouseIsPressed?.5:1,t=C.getProgressRatio()*i.TWO_PI;i.blendMode(i.BLEND),a.applyColor(),i.ellipse(c.x,c.y,e*h*(1+l*Math.cos(t)),e*h*(1+l*Math.sin(t)))}(t),p.step(),p.draw(),d.step(),d.clean(),d.draw()}),t.windowResized=(()=>{t.resizeScalableCanvas(),t.background(255)}),t.mousePressed=(()=>{}),t.touchMoved=(()=>{if(s.contains(c))return!1})},"ObjectPool");class e{constructor(e){this.p=e,this.isToBeRemoved=!1,this.isAlive=!1,this.birthTimer=new i.NonLoopedFrameCounter(15).off(),this.deathTimer=new i.NonLoopedFrameCounter(15).off(),this.coolingTimer=new i.NonLoopedFrameCounter(60).off(),this.timers=new i.SteppableArray(3),this.waitingPosition=e.createVector(),this.resetWaitingPosition(),this.position=e.createVector(),this.position.set(this.waitingPosition),this.velocity=e.createVector(),this.deathPosition=e.createVector();const t=i.subtractColor(e.color(255),e.color(i.cielchColor(80,100,e.random(0,e.TWO_PI))));this.properShapeColor=new i.ShapeColor(e,null,t),this.properLineColor=new i.ShapeColor(e,t,void 0,!0),this.timers.pushRawArray([this.birthTimer,this.deathTimer,this.coolingTimer])}static initialize(i,e,t,o){this.pool=i,this.region=e,this.deadShapeColor=t,this.deadLineColor=o}step(){this.timers.step(),this.isAlive&&this.position.add(this.velocity)}clean(){this.isAlive&&!e.region.contains(this.position)&&this.kill()}draw(){this.birthTimer.isOn?this.drawBirthLine():this.deathTimer.isOn&&this.drawDeathLine(),this.p.blendMode(this.p.DIFFERENCE),this.properShapeColor.applyColor(),this.drawShape(),this.isAlive||(this.p.blendMode(this.p.BLEND),e.deadShapeColor.applyColor(255*this.coolingTimer.getProgressRatio()),this.drawShape())}revive(i){this.isToBeRemoved=!1,this.position.set(i);const e=this.p.random(this.p.TWO_PI);this.velocity.set(Math.cos(e),Math.sin(e)),this.isAlive=!0,this.birthTimer.resetCount().on()}kill(){this.isToBeRemoved=!0,this.isAlive=!1,this.deathPosition.set(this.position),this.resetWaitingPosition(),this.position.set(this.waitingPosition),this.deathTimer.resetCount().on(),this.coolingTimer.resetCount().on(),e.pool.push(this)}resetWaitingPosition(){const i=e.pool.length,t=e.waitingColumnCount,o=this.p.nonScaledWidth/(t+1);this.waitingPosition.set((1+i%t)*o,(1+Math.floor(i/t))*o)}drawShape(){this.p.ellipse(this.position.x,this.position.y,e.size,e.size)}drawTrimmedLine(i,e,t,o){const s=e.x-i.x,n=e.y-i.y,r=i.x+t*s,a=i.y+t*n,h=i.x+o*s,l=i.y+o*n;this.p.line(r,a,h,l)}drawBirthLine(){const e=this.birthTimer.getProgressRatio();this.p.blendMode(this.p.DIFFERENCE),this.properLineColor.applyColor(64+191*e),this.drawTrimmedLine(this.waitingPosition,this.position,i.easeLinear(e),i.easeOutQuart(e))}drawDeathLine(){const t=this.deathTimer.getProgressRatio();this.p.blendMode(this.p.BLEND),e.deadLineColor.applyColor(64+191*t),this.drawTrimmedLine(this.deathPosition,this.waitingPosition,i.easeLinear(t),i.easeOutQuart(t))}}e.waitingColumnCount=32,e.size=12}(p5ex);